#!/bin/bash
# Run a few ruff commands against a given file or directory.
#
# Usage:
#
#   rf                  # run recursively against the CWD
#   rf myfile.py        # run against myfile.py
#   rf my/folder        # run recursively against my/folder
#   rf . --unsafe-fixes # pass the given latter arguments on to ruff, e.g. to allow unsafe fixes
#
# See:
# - https://docs.astral.sh/ruff/rules
#
# author: andreasl

file="${1:-.}"
shift

ruff format "$file" # --line-length 120
# shellcheck disable=SC2068
ruff check --select UP,ANN,B,C4,EXE,F,FA,FURB,I,ISC,ICN,LOG,G,NPY,PIE,Q,RET,RSE,SIM,TC,W --ignore B905,D203,D213,FA102,UP015,UP035 --fix "$file" $@
ruff check --select I --fix "$file"          # imports
ruff check --select F401,TC004 --fix "$file" # F401: remove unused imports; TC004: do add TYPE_CHECKING
ruff check "$file"
